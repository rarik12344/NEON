<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Lottery | Farcaster Mini App</title>
    
    <!-- Farcaster Frame Metadata -->
    <meta property="fc:frame" content="vNext">
    <meta property="fc:frame:image" content="https://neon-xi.vercel.app/neon-lottery-preview.png">
    <meta property="fc:frame:button:1" content="üé´ Buy Tickets">
    <meta property="fc:frame:button:2" content="üåü My Points">
    <meta property="fc:frame:button:3" content="üì£ Share">
    <meta property="fc:frame:button:4" content="üèÜ Leaderboard">
    <meta property="fc:frame:post_url" content="https://neon-xi.vercel.app/api/frame">
    
    <!-- OpenGraph Metadata -->
    <meta property="og:image" content="https://neon-xi.vercel.app/neon-lottery-share.png">
    <meta property="og:title" content="Neon Lottery - Win ETH!">
    <meta property="og:description" content="Buy tickets, win prizes and earn Neon Points!">
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Web3 Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    
    <style>
        /* –í–∞—à–∏ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        /* ... */
    </style>
</head>
<body>
    <div class="neon-bg">
        <div class="neon-circle circle-1"></div>
        <div class="neon-circle circle-2"></div>
        <div class="neon-circle circle-3"></div>
        <div class="neon-circle circle-4"></div>
        <div class="neon-circle circle-5"></div>
    </div>
    
    <div class="container" id="main-container">
        <h1>‚ú® NEON LOTTERY ‚ú®</h1>
        
        <div class="points-display">
            <div class="points-label">
                <i class="fas fa-coins" style="color: var(--neon-yellow);"></i>
                <span>Your Points:</span>
            </div>
            <div class="points-value" id="neon-points">0</div>
        </div>
        
        <div class="timer-container">
            <div class="timer" id="countdown">00:00:00</div>
            <div id="round-status">Loading round info...</div>
        </div>
        
        <div class="pool-info">
            <div class="info-item">
                <span>Ticket Price:</span>
                <span class="info-value" id="ticket-price">1.00 USD (~0.0005 ETH)</span>
            </div>
            <div class="info-item">
                <span>Current Pool:</span>
                <span class="info-value" id="current-pool">0.00 ETH</span>
            </div>
            <div class="info-item">
                <span>Participants:</span>
                <span class="info-value" id="participants">0</span>
            </div>
            <div class="info-item">
                <span>Your Tickets:</span>
                <span class="info-value" id="user-tickets">0</span>
            </div>
        </div>
        
        <div class="button-group">
            <button id="connect-btn"><i class="fas fa-wallet"></i> Connect Wallet</button>
            <button id="buy-btn" disabled><i class="fas fa-ticket-alt"></i> Buy Tickets</button>
            <button id="share-btn"><i class="fas fa-share-alt"></i> Invite Friends</button>
            <button id="leaderboard-btn"><i class="fas fa-trophy"></i> Leaderboard</button>
            <button id="history-btn"><i class="fas fa-history"></i> History</button>
            <button id="help-btn"><i class="fas fa-question-circle"></i> Help</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    <!-- ... -->

    <script>
        // Contract details (Base network)
        const CONTRACT_ADDRESS = "0x8ce1694dbce4d6445231e7f46b28599a4b4c4b91";
        const CONTRACT_ABI = [
            {
                "inputs": [
                    {
                        "internalType": "uint32",
                        "name": "_tickets",
                        "type": "uint32"
                    }
                ],
                "name": "buyTickets",
                "outputs": [],
                "stateMutability": "payable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "currentRoundInfo",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "startTime",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "endTime",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "currentPrizePool",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "currentParticipants",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "currentTickets",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "currentTicketPrice",
                        "type": "uint256"
                    },
                    {
                        "internalType": "bool",
                        "name": "active",
                        "type": "bool"
                    },
                    {
                        "internalType": "uint256",
                        "name": "ethPerTicket",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "timeRemaining",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getTicketCostETH",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "user",
                        "type": "address"
                    }
                ],
                "name": "getUserTickets",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "participants",
                "outputs": [
                    {
                        "components": [
                            {
                                "internalType": "address",
                                "name": "wallet",
                                "type": "address"
                            },
                            {
                                "internalType": "uint32",
                                "name": "tickets",
                                "type": "uint32"
                            },
                            {
                                "internalType": "uint64",
                                "name": "ticketFrom",
                                "type": "uint64"
                            },
                            {
                                "internalType": "uint64",
                                "name": "ticketTo",
                                "type": "uint64"
                            }
                        ],
                        "internalType": "struct NeonLottery.Participant[]",
                        "name": "",
                        "type": "tuple[]"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        // Base Network details
        const BASE_CHAIN_ID = '0x2105'; // Base Mainnet
        const BASE_RPC_URL = 'https://mainnet.base.org';
        const BASE_EXPLORER_URL = 'https://basescan.org';
        
        // Constants
        const POINTS_PER_TICKET = 10;
        const REFERRAL_BONUS = 100;

        // State variables
        let web3;
        let lotteryContract;
        let account = null;
        let isWarpcast = false;
        let isFrame = false;
        let walletConnectProvider = null;
        let referralCode = null;
        let currentRoundEndTime = Math.floor(Date.now() / 1000) + 86400; // Default to 24h from now

        // Initialize the app when page loads
        window.addEventListener('load', function() {
            // Check if running in Warpcast or as a frame
            isWarpcast = window.ethereum && window.ethereum.isMiniPay;
            isFrame = window.location !== window.parent.location;
            
            // Initialize Web3 and contract
            initWeb3();
            initContract();
            
            // Setup UI based on context
            if (isFrame) {
                setupFrameUI();
            } else {
                setupMainUI();
            }
            
            // Initialize event handlers
            initEventHandlers();
            
            // Start countdown timer and update round info
            startCountdown();
            updateRoundInfo();
            
            // Check if wallet is already connected
            checkConnectedWallet();
        });

        function initWeb3() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                setupWalletEvents();
            } else {
                // Use default provider if no wallet extension
                web3 = new Web3(new Web3.providers.HttpProvider(BASE_RPC_URL));
                console.log("Using default provider");
            }
        }

        function setupWalletEvents() {
            if (window.ethereum) {
                window.ethereum.on('accountsChanged', function(accounts) {
                    account = accounts[0] || null;
                    updateUI();
                    if (account) {
                        updateUserTickets();
                    }
                });
                
                window.ethereum.on('chainChanged', function(chainId) {
                    if (chainId !== BASE_CHAIN_ID) {
                        showNotification("Please switch to Base network", "error");
                    } else {
                        window.location.reload();
                    }
                });
            }
        }

        function initContract() {
            lotteryContract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
        }

        function setupMainUI() {
            document.getElementById('main-container').style.display = 'block';
            document.getElementById('frame-container').style.display = 'none';
        }

        function setupFrameUI() {
            document.getElementById('main-container').style.display = 'none';
            document.getElementById('frame-container').style.display = 'block';
        }

        function checkConnectedWallet() {
            if (window.ethereum && window.ethereum.selectedAddress) {
                account = window.ethereum.selectedAddress;
                updateUI();
                updateUserTickets();
            }
        }

        function startCountdown() {
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        function updateCountdown() {
            const now = Math.floor(Date.now() / 1000);
            const distance = currentRoundEndTime - now;
            
            if (distance < 0) {
                document.getElementById('countdown').textContent = "00:00:00";
                document.getElementById('round-status').textContent = "Round Ended - Next at 16:00 UTC";
                return;
            }
            
            const hours = Math.floor(distance / 3600);
            const minutes = Math.floor((distance % 3600) / 60);
            const seconds = Math.floor(distance % 60);
            
            document.getElementById('countdown').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
            document.getElementById('round-status').textContent = 
                distance > 0 ? "Round Active - Ends at 16:00 UTC" : "Round Ended - Next at 16:00 UTC";
        }

        function initEventHandlers() {
            // Connect Wallet button
            document.getElementById('connect-btn')?.addEventListener('click', function() {
                document.getElementById('connect-modal').style.display = 'flex';
            });
            
            // Buy Tickets button
            document.getElementById('buy-btn')?.addEventListener('click', function() {
                if (!account) {
                    showNotification("Please connect your wallet first!", "error");
                    document.getElementById('connect-modal').style.display = 'flex';
                    return;
                }
                document.getElementById('buy-modal').style.display = 'flex';
                updateTicketCost();
            });
            
            // Confirm Purchase button
            document.getElementById('confirm-buy')?.addEventListener('click', confirmPurchase);
            
            // Ticket amount controls
            document.getElementById('increment-ticket')?.addEventListener('click', function() {
                const input = document.getElementById('ticket-amount');
                input.value = parseInt(input.value) + 1;
                updateTicketCost();
            });
            
            document.getElementById('decrement-ticket')?.addEventListener('click', function() {
                const input = document.getElementById('ticket-amount');
                if (input.value > 1) {
                    input.value = parseInt(input.value) - 1;
                    updateTicketCost();
                }
            });
            
            document.getElementById('ticket-amount')?.addEventListener('input', updateTicketCost);
            
            // Close modal buttons
            document.querySelectorAll('.close-modal').forEach(function(button) {
                button.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            // Other buttons
            document.getElementById('leaderboard-btn')?.addEventListener('click', showLeaderboard);
            document.getElementById('history-btn')?.addEventListener('click', showHistory);
            document.getElementById('help-btn')?.addEventListener('click', function() {
                document.getElementById('help-modal').style.display = 'flex';
            });
            
            document.getElementById('share-btn')?.addEventListener('click', function() {
                document.getElementById('share-modal').style.display = 'flex';
            });
            
            // Wallet connection options
            document.getElementById('metamask-btn')?.addEventListener('click', connectMetaMask);
            document.getElementById('walletconnect-btn')?.addEventListener('click', connectWalletConnect);
            
            // Share modal buttons
            document.getElementById('copy-link-btn')?.addEventListener('click', copyInviteLink);
            document.getElementById('warpcast-post-btn')?.addEventListener('click', createWarpcastPost);
            
            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(function(modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
        }

        function updateRoundInfo() {
            lotteryContract.methods.currentRoundInfo().call()
                .then(function(roundInfo) {
                    currentRoundEndTime = parseInt(roundInfo.endTime);
                    
                    // Update prize pool
                    const prizePoolWei = roundInfo.currentPrizePool;
                    const prizePoolETH = web3.utils.fromWei(prizePoolWei, 'ether');
                    
                    document.getElementById('current-pool').textContent = `${parseFloat(prizePoolETH).toFixed(4)} ETH`;
                    
                    // Update participants count
                    document.getElementById('participants').textContent = roundInfo.currentParticipants;
                    
                    // Update ticket price
                    const ticketPriceETH = web3.utils.fromWei(roundInfo.ethPerTicket, 'ether');
                    document.getElementById('ticket-price').textContent = `1.00 USD (~${ticketPriceETH} ETH)`;
                })
                .catch(function(error) {
                    console.error("Error updating round info:", error);
                    // Fallback to default values if contract call fails
                    document.getElementById('current-pool').textContent = "0.00 ETH";
                    document.getElementById('participants').textContent = "0";
                });
        }

        function updateUI() {
            if (account) {
                const shortAddress = `${account.substring(0, 6)}...${account.substring(38)}`;
                document.getElementById('connect-btn').innerHTML = `<i class="fas fa-wallet"></i> ${shortAddress}`;
                document.getElementById('buy-btn').disabled = false;
                
                // Generate referral code
                referralCode = btoa(account).slice(0, 10);
                document.getElementById('referral-link').textContent = `${window.location.href}?ref=${referralCode}`;
            } else {
                document.getElementById('connect-btn').innerHTML = `<i class="fas fa-wallet"></i> Connect Wallet`;
                document.getElementById('buy-btn').disabled = true;
                document.getElementById('neon-points').textContent = "0";
                document.getElementById('user-tickets').textContent = "0";
            }
        }

        function updateUserTickets() {
            if (!account) return;
            
            lotteryContract.methods.getUserTickets(account).call()
                .then(function(userTickets) {
                    document.getElementById('user-tickets').textContent = userTickets;
                    document.getElementById('neon-points').textContent = userTickets * POINTS_PER_TICKET;
                })
                .catch(function(error) {
                    console.error("Error updating user tickets:", error);
                });
        }

        function updateTicketCost() {
            const ticketAmount = parseInt(document.getElementById('ticket-amount').value);
            if (isNaN(ticketAmount) {
                document.getElementById('ticket-amount').value = 1;
                return updateTicketCost();
            }
            
            if (ticketAmount < 1) {
                document.getElementById('ticket-amount').value = 1;
                return updateTicketCost();
            }
            
            if (ticketAmount > 100) {
                document.getElementById('ticket-amount').value = 100;
                return updateTicketCost();
            }
            
            lotteryContract.methods.getTicketCostETH(ticketAmount).call()
                .then(function(costWei) {
                    const costEth = web3.utils.fromWei(costWei, 'ether');
                    const roundedCost = parseFloat(costEth).toFixed(6);
                    
                    document.getElementById('total-cost').textContent = `${roundedCost} ETH (~$${ticketAmount.toFixed(2)})`;
                    document.getElementById('points-earned').textContent = `${ticketAmount * POINTS_PER_TICKET} Points`;
                })
                .catch(function(error) {
                    console.error("Error getting ticket cost:", error);
                    // Fallback to default calculation
                    const totalCostETH = ticketAmount / 2000; // Default ETH price $2000
                    const roundedCostETH = parseFloat(totalCostETH.toFixed(6));
                    
                    document.getElementById('total-cost').textContent = `${roundedCostETH} ETH (~$${ticketAmount.toFixed(2)})`;
                    document.getElementById('points-earned').textContent = `${ticketAmount * POINTS_PER_TICKET} Points`;
                });
        }

        async function connectMetaMask() {
            try {
                if (!window.ethereum) {
                    showNotification("Please install MetaMask!", "error");
                    window.open("https://metamask.io/download.html", "_blank");
                    return;
                }
                
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                account = accounts[0];
                
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId !== BASE_CHAIN_ID) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: BASE_CHAIN_ID }],
                        });
                    } catch (error) {
                        if (error.code === 4902) {
                            try {
                                await window.ethereum.request({
                                    method: 'wallet_addEthereumChain',
                                    params: [{
                                        chainId: BASE_CHAIN_ID,
                                        chainName: 'Base Mainnet',
                                        nativeCurrency: {
                                            name: 'Ether',
                                            symbol: 'ETH',
                                            decimals: 18
                                        },
                                        rpcUrls: [BASE_RPC_URL],
                                        blockExplorerUrls: [BASE_EXPLORER_URL]
                                    }],
                                });
                            } catch (addError) {
                                showNotification("Failed to add Base network", "error");
                                return;
                            }
                        } else {
                            showNotification("Please switch to Base network", "error");
                            return;
                        }
                    }
                }
                
                document.getElementById('connect-modal').style.display = 'none';
                updateUI();
                showNotification("MetaMask connected successfully");
                
                // Reinitialize contract with new provider
                web3 = new Web3(window.ethereum);
                lotteryContract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                
                updateUserTickets();
            } catch (error) {
                console.error("Error connecting MetaMask:", error);
                if (error.code === 4001) {
                    showNotification("MetaMask connection rejected", "error");
                } else {
                    showNotification("Failed to connect MetaMask", "error");
                }
            }
        }

        async function connectWalletConnect() {
            try {
                walletConnectProvider = new WalletConnectProvider.default({
                    rpc: {
                        [parseInt(BASE_CHAIN_ID, 16)]: BASE_RPC_URL
                    }
                });
                
                await walletConnectProvider.enable();
                
                web3 = new Web3(walletConnectProvider);
                const accounts = await web3.eth.getAccounts();
                account = accounts[0];
                
                lotteryContract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                
                document.getElementById('connect-modal').style.display = 'none';
                updateUI();
                showNotification("WalletConnect connected successfully");
                
                updateUserTickets();
                
                walletConnectProvider.on("accountsChanged", (accounts) => {
                    account = accounts[0] || null;
                    updateUI();
                });
                
                walletConnectProvider.on("chainChanged", (chainId) => {
                    if (chainId !== BASE_CHAIN_ID) {
                        showNotification("Please switch to Base network", "error");
                    } else {
                        window.location.reload();
                    }
                });
                
                walletConnectProvider.on("disconnect", () => {
                    account = null;
                    updateUI();
                    showNotification("Wallet disconnected", "info");
                });
                
            } catch (error) {
                console.error("Error connecting WalletConnect:", error);
                showNotification("Failed to connect WalletConnect", "error");
            }
        }

        async function confirmPurchase() {
            const ticketAmount = parseInt(document.getElementById('ticket-amount').value);
            
            if (!account) {
                showNotification("Please connect your wallet first!", "error");
                return;
            }
            
            if (isNaN(ticketAmount)) {
                showNotification("Please enter a valid number of tickets!", "error");
                return;
            }
            
            const confirmBtn = document.getElementById('confirm-buy');
            const originalText = confirmBtn.innerHTML;
            confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            confirmBtn.disabled = true;
            
            try {
                const costWei = await lotteryContract.methods.getTicketCostETH(ticketAmount).call();
                
                await lotteryContract.methods.buyTickets(ticketAmount).send({
                    from: account,
                    value: costWei
                });
                
                showNotification("Tickets purchased successfully!");
                document.getElementById('buy-modal').style.display = 'none';
                updateRoundInfo();
                updateUserTickets();
                
                const refCode = localStorage.getItem('neonLotteryRef');
                if (refCode && refCode !== btoa(account).slice(0, 10)) {
                    showNotification("üéâ You earned 100 bonus points from referral!", "success");
                }
                
            } catch (error) {
                console.error("Error buying tickets:", error);
                let errorMsg = "Failed to buy tickets";
                if (error.message.includes("rejected")) {
                    errorMsg = "Transaction rejected";
                } else if (error.message.includes("insufficient funds")) {
                    errorMsg = "Insufficient funds";
                }
                showNotification(errorMsg, "error");
            } finally {
                confirmBtn.innerHTML = originalText;
                confirmBtn.disabled = false;
            }
        }

        function copyInviteLink() {
            const shareUrl = account ? `${window.location.href}?ref=${referralCode}` : window.location.href;
            
            const tempInput = document.createElement('input');
            tempInput.value = shareUrl;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            
            showNotification("Invite link copied to clipboard!");
        }

        function createWarpcastPost() {
            const shareUrl = account ? `${window.location.href}?ref=${referralCode}` : window.location.href;
            const shareText = `üöÄ Join Neon Lottery and win ETH prizes! üéâ\n\nBuy tickets for a chance to win daily ETH draws and earn Neon Points!\n\nüëâ ${shareUrl}\n\n#NeonLottery #WinETH`;
            
            window.open(`https://warpcast.com/~/compose?text=${encodeURIComponent(shareText)}`, '_blank');
            showNotification("Opening Warpcast to create post...");
        }

        function showNotification(message, type = 'success') {
            if (isFrame) return;
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let iconClass;
            if (type === 'error') {
                iconClass = 'exclamation-circle';
            } else if (type === 'info') {
                iconClass = 'info-circle';
            } else {
                iconClass = 'check-circle';
            }
            
            notification.innerHTML = `<i class="fas fa-${iconClass}"></i><span>${message}</span>`;
            document.body.appendChild(notification);
            
            setTimeout(function() {
                notification.style.opacity = '0';
                setTimeout(function() {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        async function showLeaderboard() {
            try {
                const leaderboardBody = document.getElementById('leaderboard-body');
                leaderboardBody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 0.8rem;"><i class="fas fa-spinner fa-spin"></i> Loading...</td></tr>';
                
                document.getElementById('leaderboard-modal').style.display = 'flex';
                
                const participants = await lotteryContract.methods.participants().call();
                
                participants.sort((a, b) => parseInt(b.tickets) - parseInt(a.tickets));
                
                leaderboardBody.innerHTML = '';
                
                if (participants.length === 0) {
                    leaderboardBody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 0.8rem;">No participants yet</td></tr>';
                } else {
                    participants.slice(0, 10).forEach((participant, index) {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="rank">${index + 1}</td>
                            <td class="user-address">${participant.wallet.substring(0, 6)}...${participant.wallet.substring(38)}</td>
                            <td>${participant.tickets}</td>
                            <td>${participant.tickets * POINTS_PER_TICKET}</td>
                        `;
                        leaderboardBody.appendChild(row);
                    });
                }
            } catch (error) {
                console.error("Error loading leaderboard:", error);
                showNotification("Failed to load leaderboard", "error");
            }
        }

        function showHistory() {
            const historyContent = document.getElementById('history-content');
            historyContent.innerHTML = '<div style="text-align: center; padding: 0.8rem;"><i class="fas fa-spinner fa-spin"></i> Loading...</div>';
            
            document.getElementById('history-modal').style.display = 'flex';
            
            // Simulate loading
            setTimeout(() => {
                historyContent.innerHTML = '<div style="text-align: center; padding: 0.8rem;">History feature coming soon!</div>';
            }, 1000);
        }
    </script>
</body>
</html>

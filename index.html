// В начале скрипта, после объявления переменных
if (isMiniApp) {
  // Инициализация MiniApp
  window.farcasterMiniApp.on('walletChange', (wallet) => {
    if (wallet?.address) {
      account = wallet.address;
      updateUI();
    }
  });
  
  // Автоматическая проверка при загрузке
  window.addEventListener('load', async () => {
    try {
      const wallet = await window.farcasterMiniApp.getWallet();
      if (wallet?.address) {
        account = wallet.address;
        isBaseNetwork = true;
        updateUI();
      }
    } catch (error) {
      console.log("No wallet connected");
    }
  });
}

// Модифицированная функция connectWallet
async function connectWallet() {
  if (isMiniApp) {
    try {
      const wallet = await window.farcasterMiniApp.connectWallet();
      if (wallet?.address) {
        account = wallet.address;
        isBaseNetwork = true;
        updateUI();
        showNotification("Connected via Warpcast!");
        
        // Получение дополнительной информации о пользователе
        try {
          const user = await window.farcasterMiniApp.getUser();
          console.log("User profile:", user);
        } catch (e) {
          console.log("Couldn't get user profile", e);
        }
      }
    } catch (error) {
      showNotification("Connection failed", "error");
    }
  } else {
    // Оригинальная реализация для web
    await connectMetaMask();
  }
}
